<!DOCTYPE html>
<html>
<head>
    <title>Test CSV Loading</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        #log {
            background: #000;
            padding: 20px;
            border: 2px solid #0f0;
            white-space: pre-wrap;
            max-height: 80vh;
            overflow-y: auto;
        }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
    </style>
</head>
<body>
    <h1>üîç Test de Carga CSV</h1>
    <button onclick="testCSV()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
        üöÄ PROBAR CARGA CSV
    </button>
    <br><br>
    <div id="log"></div>
    
    <script>
        const log = document.getElementById('log');
        
        function addLog(msg, type = 'info') {
            const span = document.createElement('div');
            span.className = type;
            span.textContent = msg;
            log.appendChild(span);
            console.log(msg);
        }
        
        function testCSV() {
            log.innerHTML = '';
            addLog('=== INICIANDO TEST ===', 'success');
            
            // Test 1: PapaParse
            addLog('Test 1: PapaParse disponible?', 'info');
            if (typeof Papa === 'undefined') {
                addLog('‚ùå ERROR: PapaParse NO disponible', 'error');
                return;
            } else {
                addLog('‚úÖ PapaParse disponible', 'success');
            }
            
            // Test 2: Fetch CSV
            addLog('\nTest 2: Intentando cargar CSV...', 'info');
            fetch('DECE_CRUCE_X_Y_NUC_SAT.csv')
                .then(response => {
                    addLog(`üì° Response status: ${response.status}`, response.ok ? 'success' : 'error');
                    addLog(`üì° Response ok: ${response.ok}`, response.ok ? 'success' : 'error');
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    return response.text();
                })
                .then(text => {
                    addLog(`‚úÖ CSV cargado! Tama√±o: ${text.length} bytes`, 'success');
                    addLog(`‚úÖ Primeros 200 caracteres:`, 'info');
                    addLog(text.substring(0, 200), 'info');
                    
                    // Test 3: Parse
                    addLog('\nTest 3: Parseando CSV...', 'info');
                    
                    Papa.parse(text, {
                        delimiter: ';',
                        skipEmptyLines: true,
                        complete: function(results) {
                            addLog(`‚úÖ Parse completado!`, 'success');
                            addLog(`üìä Total filas: ${results.data.length}`, 'success');
                            addLog(`üìä Columnas: ${results.data[0]?.length || 0}`, 'success');
                            addLog(`üìä Primera fila (header):`, 'info');
                            addLog(JSON.stringify(results.data[0]), 'info');
                            addLog(`üìä Segunda fila (datos):`, 'info');
                            addLog(JSON.stringify(results.data[1]), 'info');
                            
                            addLog('\n=== TEST COMPLETADO CON √âXITO ===', 'success');
                        },
                        error: function(error) {
                            addLog(`‚ùå ERROR en parse: ${error}`, 'error');
                        }
                    });
                })
                .catch(error => {
                    addLog(`‚ùå ERROR: ${error.message}`, 'error');
                    addLog(`\nPosibles causas:`, 'error');
                    addLog('1. CSV no est√° en el mismo directorio', 'error');
                    addLog('2. Nombre de archivo incorrecto', 'error');
                    addLog('3. No est√°s usando servidor HTTP (usa: python -m http.server 8000)', 'error');
                });
        }
        
        addLog('Listo para probar. Click en el bot√≥n.', 'info');
    </script>
</body>
</html>
